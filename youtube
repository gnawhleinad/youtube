#!/bin/bash

VLC="cvlc"

vlc_opts="--play-and-exit"
yt_opts=""
link=""
for arg in "$@"; do
        case $arg in
                --audio)
                        yt_opts="--extract-audio --audio-quality 0"
                        ;;
                --loop)
                        vlc_opts="--loop"
                        ;;
                *)
                        link=`echo $arg | grep "youtube.com\|youtu.be"`
                        ;;
        esac
        shift
done

os=$(([[ -f /etc/lsb-release ]] && grep -q -i "Ubuntu" /etc/lsb-release) \
        && echo "ubuntu" || echo "os x")
if [[ "$os" == "os x" ]]; then
        VLC="vlc"
        [[ -z $link ]] && link=`pbpaste`
else
        [[ -z $link ]] && link=`xclip -selection clipboard -out`
fi

link=`echo "$link" | grep "youtube.com\|youtu.be"`
if [ -z "$link" ]; then
        echo "A youtube link was not found."
        exit
fi

file=`youtube-dl $yt_opts --get-filename --output "%(id)s.%(ext)s" "$link"`
file="/var/tmp/"$file
if [ -e $file ]; then
        $VLC $vlc_opts --quiet $file &
        exit
fi

youtube-dl $yt_opts --no-part --output "$file" \
        --exec "$VLC $vlc_opts --quiet {} &" "$link"
